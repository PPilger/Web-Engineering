<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core">
    <h:body>
        <ui:composition template="main.xhtml">
            <ui:define name="title">
                <title>#{msg.tableTitle}</title>
            </ui:define>
            <ui:define name="navigation">
                <h:form id="navForm">
                    <ul>
                        <li><h:commandLink id="startNewGame" onclick="test()" tabindex="1" value="Neues Spiel">
                                <f:ajax event="click" listener="#{gameBean.newGame()}" />
                            </h:commandLink></li>
                        <li><h:commandLink id="logout" action="logout" tabindex="2" value="Ausloggen" /></li>
                    </ul>
                </h:form>
            </ui:define>
            <ui:define name="content">
                <div id="main-area">
                    <div class="info">
                        <h2>Spielinformationen</h2>

                        <table summary="Diese Tabelle zeigt Informationen zum aktuellen Spiel">
                            <tr>
                                <th id="leaderLabel" class="label">F&uuml;hrender</th>
                                <td id="leader" class="data"><h:outputText value="#{gameBean.game.leader}"/></td>
                            </tr>
                            <tr>
                                <th id="roundLabel" class="label">Runde</th>
                                <td id="round" class="data"><h:outputText value="#{gameBean.game.round}"/></td>
                            </tr>
                            <tr>
                                <th id="timeLabel" class="label">Zeit</th>
                                <td id="time" class="data"><h:outputText value="#{gameBean.game.spentTime}"/></td></tr>
                            <tr>
                                <th id="computerScoreLabel" class="label">W&uuml;rfelergebnis <em><h:outputText value="#{gameBean.game.player2.name}"/></em></th>
                                <td id="computerScore" class="data"><h:outputText value="#{gameBean.game.player2.lastResult}"/></td>
                            </tr>
                        </table>

                        <h2>Spieler</h2>

                        <table summary="Diese Tabelle listet die Namen der Spieler auf">
                            <tr>
                                <th id="player1NameLabel" class="label">Spieler 1</th>
                                <td id="player1Name" class="data"><h:outputText value="#{gameBean.game.player1.name}"/></td>
                            </tr>
                            <tr>
                                <th id="player2NameLabel" class="label">Spieler 2</th>
                                <td id="player2Name" class="data"><h:outputText value="#{gameBean.game.player2.name}"/></td>
                            </tr>
                        </table>    	  
                    </div>
                    <div id="field" class="field">
                        <h2 class="accessibility">Spielbereich</h2>
                        <ol id="road">
                            <li id="start_road">
                                <span class="accessibility">Startfeld</span>
                            </li>
                            <li class="empty_road" id="road_1">
                                <span class="accessibility">Feld 2</span>
                            </li>
                            <li class="oil_road" id="road_2">
                                <span class="accessibility">Feld 3</span>
                                <span id="player1">
                                    <span class="accessibility"><em>Spieler 1</em></span>
                                </span>
                            </li>
                            <li class="empty_road" id="road_3">
                                <span class="accessibility">Feld 4</span>
                            </li>
                            <li class="empty_road" id="road_4">
                                <span class="accessibility">Feld 5</span>
                                <span id="player2">
                                    <span class="accessibility"><em>Spieler 2</em></span>
                                </span>
                            </li>
                            <li class="oil_road" id="road_5">
                                <span class="accessibility">Feld 6</span>
                            </li>
                            <li id="finish_road">
                                <span class="accessibility">Zielfeld</span>
                            </li>
                        </ol>
                    </div>
                    <div id="player" class="player">
                        <h2 class="accessibility">W&uuml;rfelbereich</h2>
                        <span class="accessibility">An der Reihe ist</span>
                        <div id="currentPlayerName"><h:outputText value="#{gameBean.game.player1.name}"/></div>
                        <h:form id="form">
                            <h:button id="dice" onclick="test()" tabindex="4" image="resources/img/wuerfel#{gameBean.game.player1.lastResult}.png" title="W&uuml;rfel mit einer #{gameBean.playerResultAsString}" alt="W&uuml;rfel mit einer #{gameBean.playerResultAsString}">
                                <f:ajax onevent="onRollDice" event="click" listener="#{gameBean.rollDice()}"/>
                            </h:button>
                        </h:form>
                    </div>
                </div>
            </ui:define>
        </ui:composition>
        
        <script type="text/javascript">
            //<![CDATA[
            function test() {
                alert('ahhh')
            }

            function moveTo(player, position) {
                if (position <= 0) {
                    player.appendTo("#start_road");
                } else if (position >= 6) {
                    player.appendTo("#finish_road");
                } else {
                    player.appendTo("#road_" + position);
                }
            }

            function animateFromTo(player, oldPos, newPos, callback) {
                oldPos = Math.min(oldPos, 6);
                newPos = Math.min(newPos, 6);

                if (oldPos === newPos) {
                    moveTo(player, oldPos);
                    callback();
                } else {
                    moveTo(player, oldPos);
                    player.fadeOut(700, function() {
                        moveTo(player, newPos);
                        player.fadeIn(700, callback);
                    });
                }
            }

            function animation(player, oldPos, lastResult, newPos, callback) {
                animateFromTo(player, oldPos, oldPos + lastResult, function() {
                    animateFromTo(player, oldPos + lastResult, newPos, callback);
                });
            }

            function onRollDice(data) {
                var status = data.status;
                alert("onRollDice");

                switch (status) {
                    case 'begin': // On before the ajax request is sent.
                        break;
                    case 'complete': // On after the ajax response is arrived.
                        break;
                    case 'success': // On after the HTML DOM is updated (re-rendered).
                        moveTo($("#player1"), #{gameBean.game.player1.position});
                        moveTo($("#player2"), #{gameBean.game.player2.position});

                        animation($("#player1"),
                                #{gameBean.game.player1.position},
                                #{gameBean.game.player1.lastResult},
                                #{gameBean.game.player1.nextPosition},
                                function() {
                                    animation($("#player2"),
                                            #{gameBean.game.player2.position},
                                            #{gameBean.game.player2.lastResult},
                                            #{gameBean.game.player2.nextPosition},
                                            function(){});
                                });
                        break;
                }
            }
            //]]>
        </script>
    </h:body>
</html>